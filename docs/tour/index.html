
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Aqueduct, a Dart server-side framework.">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.9.0">
    
    
      
        <title>Tour - Aqueduct</title>
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-0a3554af36.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../style/css/override.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href=".." title="Aqueduct" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Tour
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Aqueduct
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/stablekernel/aqueduct" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../core_concepts/" title="Core Concepts" class="md-nav__link">
      Core Concepts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting_started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Tour
      </label>
    
    <a href="./" title="Tour" class="md-nav__link md-nav__link--active">
      Tour
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-line-interface-cli" title="Command-Line Interface (CLI)" class="md-nav__link">
    Command-Line Interface (CLI)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" title="Initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routing" title="Routing" class="md-nav__link">
    Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controllers" title="Controllers" class="md-nav__link">
    Controllers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resourcecontrollers" title="ResourceControllers" class="md-nav__link">
    ResourceControllers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managedobjectcontrollers" title="ManagedObjectControllers" class="md-nav__link">
    ManagedObjectControllers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-and-concurrency" title="Running and Concurrency" class="md-nav__link">
    Running and Concurrency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql-orm" title="PostgreSQL ORM" class="md-nav__link">
    PostgreSQL ORM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-data-model" title="Defining a Data Model" class="md-nav__link">
    Defining a Data Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-migrations" title="Database Migrations" class="md-nav__link">
    Database Migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth-20" title="OAuth 2.0" class="md-nav__link">
    OAuth 2.0
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" title="Logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-with-a-database" title="Testing with a Database" class="md-nav__link">
    Testing with a Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../best_practices/" title="Best Practices" class="md-nav__link">
      Best Practices
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../intellij/" title="IntelliJ IDEA Templates" class="md-nav__link">
      IntelliJ IDEA Templates
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Tutorial
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Tutorial
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tut/getting-started/" title="1. Getting Started" class="md-nav__link">
      1. Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tut/executing-queries/" title="2. Reading from a Database" class="md-nav__link">
      2. Reading from a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tut/storing-data/" title="3. Storing Data in a Database" class="md-nav__link">
      3. Storing Data in a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tut/writing-tests/" title="4. Configuration and Testing" class="md-nav__link">
      4. Configuration and Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tut/oauth2/" title="5. Authentication and Authorization" class="md-nav__link">
      5. Authentication and Authorization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-1" type="checkbox" id="nav-8-1">
    
    <label class="md-nav__link" for="nav-8-1">
      Application Configuration and Behavior
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-1">
        Application Configuration and Behavior
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../application/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application/channel/" title="Starting and Stopping Applications" class="md-nav__link">
      Starting and Stopping Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application/configure/" title="Configuring an Application and its Environment" class="md-nav__link">
      Configuring an Application and its Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application/structure/" title="Application and Project Structure" class="md-nav__link">
      Application and Project Structure
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../application/threading/" title="Multi-threading" class="md-nav__link">
      Multi-threading
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      Handling HTTP Requests
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        Handling HTTP Requests
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../http/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/controller/" title="Handling Requests and Sending Response" class="md-nav__link">
      Handling Requests and Sending Response
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/request_and_response/" title="Serializing Request and Response Bodies" class="md-nav__link">
      Serializing Request and Response Bodies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/routing/" title="Routing" class="md-nav__link">
      Routing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/resource_controller/" title="Request Binding with Resource Controllers" class="md-nav__link">
      Request Binding with Resource Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/serving_files/" title="Serving Files and Caching" class="md-nav__link">
      Serving Files and Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/websockets/" title="Websockets" class="md-nav__link">
      Websockets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../http/file_upload/" title="Uploading Files" class="md-nav__link">
      Uploading Files
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      Databases and ORM
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        Databases and ORM
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../db/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/connecting/" title="Connecting to a Database" class="md-nav__link">
      Connecting to a Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/modeling_data/" title="Modeling Data and Relationships" class="md-nav__link">
      Modeling Data and Relationships
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/serialization/" title="Serialization and Deserialization" class="md-nav__link">
      Serialization and Deserialization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/executing_queries/" title="Basic Queries" class="md-nav__link">
      Basic Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/advanced_queries/" title="Advanced Queries" class="md-nav__link">
      Advanced Queries
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/validations/" title="Validations" class="md-nav__link">
      Validations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/db_tools/" title="Migration and Tooling" class="md-nav__link">
      Migration and Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../db/json_columns/" title="JSON Document Storage" class="md-nav__link">
      JSON Document Storage
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-4" type="checkbox" id="nav-8-4">
    
    <label class="md-nav__link" for="nav-8-4">
      Authorization and OAuth 2.0
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-4">
        Authorization and OAuth 2.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/server/" title="Setting up Authorization" class="md-nav__link">
      Setting up Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/authorizer/" title="Protecting Routes" class="md-nav__link">
      Protecting Routes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/controllers/" title="Issuing Access Tokens" class="md-nav__link">
      Issuing Access Tokens
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/cli/" title="Managing OAuth 2.0 Clients" class="md-nav__link">
      Managing OAuth 2.0 Clients
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/auth_scopes/" title="OAuth 2.0 Scoping" class="md-nav__link">
      OAuth 2.0 Scoping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../auth/what_is_oauth/" title="What is OAuth 2.0?" class="md-nav__link">
      What is OAuth 2.0?
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-5" type="checkbox" id="nav-8-5">
    
    <label class="md-nav__link" for="nav-8-5">
      Development and Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-5">
        Development and Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/tests/" title="Writing Tests" class="md-nav__link">
      Writing Tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/mixins/" title="Testing with the ORM and OAuth 2.0" class="md-nav__link">
      Testing with the ORM and OAuth 2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/debugger/" title="Using the Debugger" class="md-nav__link">
      Using the Debugger
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/clients/" title="Developing Client Applications" class="md-nav__link">
      Developing Client Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../testing/mock/" title="Mocking Services" class="md-nav__link">
      Mocking Services
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-6" type="checkbox" id="nav-8-6">
    
    <label class="md-nav__link" for="nav-8-6">
      Deployment
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-6">
        Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/deploy_local/" title="Deploy Locally" class="md-nav__link">
      Deploy Locally
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/deploy_docker/" title="Deploying with Docker and Kubernetes" class="md-nav__link">
      Deploying with Docker and Kubernetes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/deploy_heroku/" title="Deploy on Heroku" class="md-nav__link">
      Deploy on Heroku
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/deploy_aws/" title="Deploy on AWS" class="md-nav__link">
      Deploy on AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../deploy/script/" title="Deploying without aqueduct serve" class="md-nav__link">
      Deploying without aqueduct serve
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-7" type="checkbox" id="nav-8-7">
    
    <label class="md-nav__link" for="nav-8-7">
      OpenAPI Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-7">
        OpenAPI Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../openapi/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openapi/cli/" title="Creating an OpenAPI Document" class="md-nav__link">
      Creating an OpenAPI Document
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openapi/components/" title="Documenting Components" class="md-nav__link">
      Documenting Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openapi/endpoint/" title="Documenting Endpoint Controllers" class="md-nav__link">
      Documenting Endpoint Controllers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../openapi/middleware/" title="Documenting Middleware Controllers" class="md-nav__link">
      Documenting Middleware Controllers
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-8" type="checkbox" id="nav-8-8">
    
    <label class="md-nav__link" for="nav-8-8">
      Command-line Tooling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-8">
        Command-line Tooling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/create/" title="Creating Applications" class="md-nav__link">
      Creating Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/running/" title="Running Applications" class="md-nav__link">
      Running Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cli/document/" title="Generating an OpenAPI/Swagger Specification" class="md-nav__link">
      Generating an OpenAPI/Swagger Specification
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Snippets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Snippets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../snippets/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snippets/http/" title="HTTP" class="md-nav__link">
      HTTP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snippets/orm/" title="ORM" class="md-nav__link">
      ORM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snippets/auth/" title="Authentication and Authorization" class="md-nav__link">
      Authentication and Authorization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../snippets/test/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#command-line-interface-cli" title="Command-Line Interface (CLI)" class="md-nav__link">
    Command-Line Interface (CLI)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialization" title="Initialization" class="md-nav__link">
    Initialization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#routing" title="Routing" class="md-nav__link">
    Routing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controllers" title="Controllers" class="md-nav__link">
    Controllers
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#resourcecontrollers" title="ResourceControllers" class="md-nav__link">
    ResourceControllers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managedobjectcontrollers" title="ManagedObjectControllers" class="md-nav__link">
    ManagedObjectControllers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-and-concurrency" title="Running and Concurrency" class="md-nav__link">
    Running and Concurrency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql-orm" title="PostgreSQL ORM" class="md-nav__link">
    PostgreSQL ORM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-a-data-model" title="Defining a Data Model" class="md-nav__link">
    Defining a Data Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-migrations" title="Database Migrations" class="md-nav__link">
    Database Migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#oauth-20" title="OAuth 2.0" class="md-nav__link">
    OAuth 2.0
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" title="Logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-with-a-database" title="Testing with a Database" class="md-nav__link">
    Testing with a Database
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" title="Documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stablekernel/aqueduct/edit/docs/source/source/docs/tour.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="aqueduct-a-tour">Aqueduct: A Tour</h1>
<p>The tour demonstrates many of Aqueduct's features.</p>
<h3 id="command-line-interface-cli">Command-Line Interface (CLI)</h3>
<p>The <code>aqueduct</code> command line tool creates, runs and documents Aqueduct applications; manages database migrations; and manages OAuth client identifiers. Install by running <code>pub global activate aqueduct</code> on a machine with Dart installed.</p>
<p>Create and run an application:</p>
<div class="codehilite"><pre><span></span>aqueduct create my_app
cd my_app/
aqueduct serve
</pre></div>


<h3 id="initialization">Initialization</h3>
<p>An Aqueduct application starts at an <a href="../application/channel/">ApplicationChannel</a>. You subclass it once per application to handle initialization tasks like setting up routes and database connections. An example application looks like this:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">TodoApp</span> <span class="kd">extends</span> <span class="n">ApplicationChannel</span> <span class="p">{</span>
  <span class="n">ManagedContext</span> <span class="n">context</span><span class="p">;</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="n">Future</span> <span class="n">prepare</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">ManagedContext</span><span class="p">(...);</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="n">Controller</span> <span class="kd">get</span> <span class="n">entryPoint</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">();</span>

    <span class="n">router</span>
      <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/projects/[:id]&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">ProjectController</span><span class="p">(</span><span class="n">context</span><span class="p">));</span>

    <span class="k">return</span> <span class="n">router</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="routing">Routing</h3>
<p>A <a href="../http/routing/">router</a> determines which controller object should handle a request. The <em>route specification syntax</em> is a concise syntax to construct routes with variables and optional segments in a single statement.</p>
<div class="codehilite"><pre><span></span><span class="err">@</span><span class="n">override</span>
<span class="n">Controller</span> <span class="kd">get</span> <span class="n">entryPoint</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">();</span>

  <span class="c1">// Handles /users, /users/1, /users/2, etc.</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/projects/[:id]&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">ProjectController</span><span class="p">());</span>

  <span class="c1">// Handles any route that starts with /file/</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/file/*&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">FileController</span><span class="p">());</span>

  <span class="c1">// Handles the specific route /health</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">linkFunction</span><span class="p">((</span><span class="n">req</span><span class="p">)</span> <span class="kd">async</span> <span class="o">=&gt;</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="kc">null</span><span class="p">));</span>

  <span class="k">return</span> <span class="n">router</span><span class="p">;</span>
<span class="p">}</span>    
</pre></div>


<h2 id="controllers">Controllers</h2>
<p><a href="../http/controller/">Controllers</a> handle requests. A controller handles a request by overriding its <code>handle</code> method. This method either returns a response or a request. If a response is returned, that response is sent to the client. If the request is returned, the linked controller handles the request.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">SecretKeyAuthorizer</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">override</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">RequestOrResponse</span><span class="o">&gt;</span> <span class="n">handle</span><span class="p">(</span><span class="n">Request</span> <span class="n">request</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">raw</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;x-secret-key&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;secret!&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">request</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">badRequest</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>This behavior allows for middleware controllers to be linked together, such that a request goes through a number of steps before it is finally handled.</p>
<p>All controllers execute their code in an exception handler. If an exception is thrown in your controller code, a response with an appropriate error code is returned. You subclass <code>HandlerException</code> to provide error response customization for application-specific exceptions.</p>
<h3 id="resourcecontrollers">ResourceControllers</h3>
<p><a href="../http/resource_controller/">ResourceControllers</a> are the most often used controller. Each operation - e.g. <code>POST /projects</code>, <code>GET /projects</code> and <code>GET /projects/1</code> - is mapped to methods in a subclass. Parameters of those methods are annotated to bind the values of the request when the method is invoked.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span>

<span class="n">class</span> <span class="n">ProjectController</span> <span class="n">extends</span> <span class="n">ResourceController</span> <span class="err">{</span>    
  <span class="err">@</span><span class="n">Operation</span><span class="err">.</span><span class="n">get</span><span class="err">(</span><span class="s1">&#39;id&#39;</span><span class="err">)</span>
  <span class="n">Future</span><span class="err">&lt;</span><span class="n">Response</span><span class="err">&gt;</span> <span class="n">getProjectById</span><span class="err">(@</span><span class="n">Bind</span><span class="err">.</span><span class="n">path</span><span class="err">(</span><span class="s2">&quot;id&quot;</span><span class="err">)</span> <span class="n">int</span> <span class="n">id</span><span class="err">)</span> <span class="n">async</span> <span class="err">{</span>
    <span class="err">//</span> <span class="n">GET</span> <span class="err">/</span><span class="n">projects</span><span class="err">/:</span><span class="n">id</span>
    <span class="n">return</span> <span class="n">Response</span><span class="err">.</span><span class="n">ok</span><span class="err">(...)</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="n">Operation</span><span class="p">.</span><span class="n">post</span><span class="p">()</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">createProject</span><span class="p">(</span><span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">body</span><span class="p">()</span> <span class="n">Project</span> <span class="n">project</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// POST /project</span>
    <span class="kd">final</span> <span class="n">inserted</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">insertProject</span><span class="p">(</span><span class="n">project</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">inserted</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="err">@</span><span class="n">Operation</span><span class="p">.</span><span class="kd">get</span><span class="p">()</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllProjects</span><span class="p">(</span>
    <span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;x-client-id&quot;</span><span class="p">)</span> <span class="kt">String</span> <span class="n">clientId</span><span class="p">,</span>
    <span class="p">{</span><span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">)</span> <span class="kt">int</span> <span class="nl">limit:</span> <span class="m">10</span><span class="p">})</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="c1">// GET /projects</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(...);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="managedobjectcontrollers">ManagedObjectControllers</h3>
<p><code>ManagedObjectController&lt;T&gt;</code>s are <code>ResourceController</code>s that automatically map a REST interface to database queries; e.g. <code>POST</code> inserts a row, <code>GET</code> gets all row of a type. They do not need to be subclassed, but can be to provide customization.</p>
<div class="codehilite"><pre><span></span><span class="n">router</span>
  <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/users/[:id]&quot;</span><span class="p">)</span>
  <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">ManagedObjectController</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">));</span>
</pre></div>


<h2 id="configuration">Configuration</h2>
<p>An application's configuration is written in a YAML file. Each environment your application runs in (e.g., locally, under test, production, development) has different values for things like the port to listen on and database connection credentials. The format of a configuration file is defined by your application. An example looks like:</p>
<div class="codehilite"><pre><span></span>// config.yaml
database:
  host: api.projects.com
  port: 5432
  databaseName: project
port: 8000
</pre></div>


<p>Subclass <code>Configuration</code> and declare a property for each key in your configuration file:</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">TodoConfig</span> <span class="kd">extends</span> <span class="n">Configuration</span> <span class="p">{</span>
  <span class="n">TodoConfig</span><span class="p">(</span><span class="kt">String</span> <span class="n">path</span><span class="p">)</span> <span class="o">:</span> <span class="k">super</span><span class="p">.</span><span class="n">fromFile</span><span class="p">(</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>

  <span class="n">DatabaseConfiguration</span> <span class="n">database</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The default name of your configuration file is <code>config.yaml</code>, but can be changed at the command-line. You create an instance of your configuration from the configuration file path from your application options:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">TodoApp</span> <span class="kd">extends</span> <span class="n">ApplicationChannel</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">override</span>
  <span class="n">Future</span> <span class="n">prepare</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">options</span> <span class="o">=</span> <span class="n">TodoConfig</span><span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">configurationFilePath</span><span class="p">);</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="running-and-concurrency">Running and Concurrency</h3>
<p>Aqueduct applications are run with the <code>aqueduct serve</code> command line tool. You can attach debugging and instrumentation tools and specify how many threads the application should run on:</p>
<div class="codehilite"><pre><span></span>aqueduct serve --observe --isolates 5 --port 8888
</pre></div>


<p>Aqueduct applications are multi-isolate (multi-threaded). Each isolate runs a replica of the same web server with its own set of services like database connections. This makes behavior like database connection pooling implicit.</p>
<h2 id="postgresql-orm">PostgreSQL ORM</h2>
<p>The <code>Query&lt;T&gt;</code> class configures and executes database queries. Its type argument determines what table is to be queried and the type of object you will work with in your code.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span>

<span class="n">class</span> <span class="n">ProjectController</span> <span class="n">extends</span> <span class="n">ResourceController</span> <span class="err">{</span>
  <span class="n">ProjectController</span><span class="err">(</span><span class="n">this</span><span class="err">.</span><span class="n">context</span><span class="err">)</span><span class="p">;</span>

  <span class="kd">final</span> <span class="n">ManagedContext</span> <span class="n">context</span><span class="p">;</span>

  <span class="err">@</span><span class="n">Operation</span><span class="p">.</span><span class="kd">get</span><span class="p">()</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">getAllProjects</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

    <span class="kd">final</span> <span class="n">results</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="n">results</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Configuration of the query - like its <code>WHERE</code> clause - are configured through a fluent, type-safe syntax. A property selector identifies which column of the table to apply an expression to. The following query fetches all project's due in the next week and includes their tasks by joining the related table.</p>
<div class="codehilite"><pre><span></span><span class="kd">final</span> <span class="n">nextWeek</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">Duration</span><span class="p">(</span><span class="nl">days:</span> <span class="m">7</span><span class="p">));</span>
<span class="kd">final</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">dueDate</span><span class="p">).</span><span class="n">isLessThan</span><span class="p">(</span><span class="n">nextWeek</span><span class="p">)</span>
  <span class="p">..</span><span class="n">join</span><span class="p">(</span><span class="kd">set</span><span class="o">:</span> <span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">tasks</span><span class="p">);</span>
<span class="kd">final</span> <span class="n">projects</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>
</pre></div>


<p>Rows are inserted or updated by setting the statically-typed values of a query.</p>
<div class="codehilite"><pre><span></span><span class="kd">final</span> <span class="n">insertQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="p">..</span><span class="n">values</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Build an aqueduct&quot;</span>
  <span class="p">..</span><span class="n">values</span><span class="p">.</span><span class="n">dueDate</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">);</span>
<span class="kd">var</span> <span class="n">newProject</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">insertQuery</span><span class="p">.</span><span class="n">insert</span><span class="p">();</span>  

<span class="kd">final</span> <span class="n">updateQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">equalTo</span><span class="p">(</span><span class="n">newProject</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
  <span class="p">..</span><span class="n">values</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Build a miniature aqueduct&quot;</span><span class="p">;</span>
<span class="n">newProject</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">updateQuery</span><span class="p">.</span><span class="n">updateOne</span><span class="p">();</span>  
</pre></div>


<p><code>Query&lt;T&gt;</code>s can perform sorting, joining and paging queries.</p>
<div class="codehilite"><pre><span></span><span class="kd">final</span> <span class="n">overdueQuery</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
  <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">dueDate</span><span class="p">).</span><span class="n">lessThan</span><span class="p">(</span><span class="n">DateTime</span><span class="p">().</span><span class="n">now</span><span class="p">())</span>
  <span class="p">..</span><span class="n">sortBy</span><span class="p">((</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">dueDate</span><span class="p">,</span> <span class="n">QuerySortOrder</span><span class="p">.</span><span class="n">ascending</span><span class="p">)</span>
  <span class="p">..</span><span class="n">join</span><span class="p">(</span><span class="nl">object:</span> <span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">owner</span><span class="p">);</span>

<span class="kd">final</span> <span class="n">overdueProjectsAndTheirOwners</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">fetch</span><span class="p">();</span>
</pre></div>


<p>Controllers will interpret exceptions thrown by queries to return an appropriate error response to the client. For example, unique constraint conflicts return 409, missing required properties return 400 and database connection failure returns 503.</p>
<h3 id="defining-a-data-model">Defining a Data Model</h3>
<p>To use the ORM, you declare your tables as Dart types and create a subclass of <code>ManagedObject&lt;T&gt;</code>. A subclass maps to a table in the database, each instance maps to a row, and each property is a column. The following declaration will map to a table named <code>_project</code> with columns <code>id</code>, <code>name</code> and <code>dueDate</code>.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Project</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_Project</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_Project</span> <span class="p">{</span>
  <span class="kt">bool</span> <span class="kd">get</span> <span class="n">isPastDue</span> <span class="o">=&gt;</span> <span class="n">dueDate</span><span class="p">.</span><span class="n">difference</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">now</span><span class="p">()).</span><span class="n">inSeconds</span> <span class="o">&lt;</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_Project</span>  <span class="p">{</span>
  <span class="err">@</span><span class="n">primaryKey</span>
  <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>

  <span class="err">@</span><span class="n">Column</span><span class="p">(</span><span class="nl">indexed:</span> <span class="kc">true</span><span class="p">)</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>

  <span class="n">DateTime</span> <span class="n">dueDate</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>Managed objects have relationships to other managed objects. Relationships can be has-one, has-many and many-to-many. A relationship is always two-sided - the related types must declare a property that references each other.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">Project</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_Project</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_Project</span> <span class="p">{}</span>
<span class="kd">class</span> <span class="nc">_Project</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="c1">// Project has-many Tasks</span>
  <span class="n">ManagedSet</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span> <span class="n">tasks</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Task</span> <span class="kd">extends</span> <span class="n">ManagedObject</span><span class="o">&lt;</span><span class="n">_Task</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">_Task</span> <span class="p">{}</span>
<span class="kd">class</span> <span class="nc">_Task</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="c1">// Task belongs to a project, maps to &#39;project_id&#39; foreign key column</span>
  <span class="err">@</span><span class="n">Relate</span><span class="p">(</span><span class="err">#</span><span class="n">tasks</span><span class="p">)</span>
  <span class="n">Project</span> <span class="n">project</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p><code>ManagedObject&lt;T&gt;</code>s are serializable and can be directly read from a request body, or encoded as a response body.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">ProjectController</span> <span class="kd">extends</span> <span class="n">ResourceController</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">Operation</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&gt;</span> <span class="n">updateProject</span><span class="p">(</span><span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="kt">int</span> <span class="n">projectId</span><span class="p">,</span> <span class="err">@</span><span class="n">Bind</span><span class="p">.</span><span class="n">body</span><span class="p">()</span> <span class="n">Project</span> <span class="n">project</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
      <span class="p">..</span><span class="n">where</span><span class="p">((</span><span class="n">project</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">project</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">equalTo</span><span class="p">(</span><span class="n">projectId</span><span class="p">)</span>
      <span class="p">..</span><span class="n">values</span> <span class="o">=</span> <span class="n">project</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">Response</span><span class="p">.</span><span class="n">ok</span><span class="p">(</span><span class="kd">await</span> <span class="n">query</span><span class="p">.</span><span class="n">updateOne</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h3 id="database-migrations">Database Migrations</h3>
<p>The CLI will automatically generate database migration scripts by detecting changes to your managed objects. The following, when ran in a project directory, will generate and execute a database migration.</p>
<div class="codehilite"><pre><span></span>aqueduct db generate
aqueduct db upgrade --connect postgres://user:password@host:5432/database
</pre></div>


<p>You can edit migration files by hand to alter any assumptions or enter required values, and run <code>aqueduct db validate</code> to ensure the changes still yield the same schema. Be sure to keep generated files in version control.</p>
<h2 id="oauth-20">OAuth 2.0</h2>
<p>An OAuth 2.0 server implementation handles authentication and authorization for Aqueduct applications. You create an <code>AuthServer</code> and its delegate as services in your application. The delegate is configurable and manages how tokens are generated and stored. By default, access tokens are a random 32-byte string and client identifiers, tokens and access codes are stored in your database using the ORM.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;package:aqueduct/aqueduct.dart&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">&#39;package:aqueduct/managed_auth.dart&#39;</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">AppApplicationChannel</span> <span class="kd">extends</span> <span class="n">ApplicationChannel</span> <span class="p">{</span>
  <span class="n">AuthServer</span> <span class="n">authServer</span><span class="p">;</span>
  <span class="n">ManagedContext</span> <span class="n">context</span><span class="p">;</span>

  <span class="err">@</span><span class="n">override</span>
  <span class="n">Future</span> <span class="n">prepare</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="n">context</span> <span class="o">=</span> <span class="n">ManagedContext</span><span class="p">(...);</span>

    <span class="kd">final</span> <span class="n">delegate</span> <span class="o">=</span> <span class="n">ManagedAuthDelegate</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
    <span class="n">authServer</span> <span class="o">=</span> <span class="n">AuthServer</span><span class="p">(</span><span class="n">delegate</span><span class="p">);</span>
  <span class="p">}</span>  
<span class="p">}</span>
</pre></div>


<p>Built-in authentication controllers for exchanging user credentials for access tokens are named <code>AuthController</code> and <code>AuthCodeController</code>. <code>Authorizer</code>s are middleware that require a valid access token to access their linked controller.</p>
<div class="codehilite"><pre><span></span><span class="n">Controller</span> <span class="kd">get</span> <span class="n">entryPoint</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">router</span> <span class="o">=</span> <span class="n">Router</span><span class="p">();</span>

  <span class="c1">// POST /auth/token with username and password (or access code) to get access token</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/auth/token&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">AuthController</span><span class="p">(</span><span class="n">authServer</span><span class="p">));</span>

  <span class="c1">// GET /auth/code returns login form, POST /auth/code grants access code</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/auth/code&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">AuthCodeController</span><span class="p">(</span><span class="n">authServer</span><span class="p">));</span>

  <span class="c1">// ProjectController requires request to include access token</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/projects/[:id]&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">Authorizer</span><span class="p">.</span><span class="n">bearer</span><span class="p">(</span><span class="n">authServer</span><span class="p">))</span>
    <span class="p">.</span><span class="n">link</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">ProjectController</span><span class="p">(</span><span class="n">context</span><span class="p">));</span>

  <span class="k">return</span> <span class="n">router</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The CLI has tools to manage OAuth 2.0 client identifiers and access scopes.</p>
<div class="codehilite"><pre><span></span>aqueduct auth add-client \
  --id com.app.mobile \
  --secret foobar \
  --redirect-uri https://somewhereoutthere.com \
  --allowed-scopes &quot;users projects admin.readonly&quot;
</pre></div>


<h2 id="logging">Logging</h2>
<p>All requests are logged to an application-wide logger. Set up a listener for the logger in <code>ApplicationChannel</code> to write log messages to the console or another medium.</p>
<div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">WildfireChannel</span> <span class="kd">extends</span> <span class="n">ApplicationChannel</span> <span class="p">{</span>
  <span class="err">@</span><span class="n">override</span>
  <span class="n">Future</span> <span class="n">prepare</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="n">onRecord</span><span class="p">.</span><span class="n">listen</span><span class="p">((</span><span class="n">record</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$</span><span class="n">record</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="testing">Testing</h2>
<p>Aqueduct tests start a local version of your application and execute requests. You write expectations on the responses. A <a href="../testing/tests/">TestHarness</a> manages the starting and stopping of an application, and exposes a default <code>Agent</code> for executing requests. An <code>Agent</code> can be configured to have default headers, and multiple agents can be used within the same test.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="s1">&#39;harness/app.dart&#39;</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">harness</span> <span class="o">=</span> <span class="n">TestHarness</span><span class="o">&lt;</span><span class="n">TodoApp</span><span class="o">&gt;</span><span class="p">()..</span><span class="n">install</span><span class="p">();</span>

  <span class="n">test</span><span class="p">(</span><span class="s2">&quot;GET /projects returns all projects&quot;</span> <span class="p">,</span> <span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">harness</span><span class="p">.</span><span class="n">agent</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s2">&quot;/projects&quot;</span><span class="p">);</span>
    <span class="n">expectResponse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="m">200</span><span class="p">,</span> <span class="nl">body:</span> <span class="n">every</span><span class="p">(</span><span class="n">partial</span><span class="p">({</span>
      <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="n">greaterThan</span><span class="p">(</span><span class="m">0</span><span class="p">),</span>
      <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="n">isNotNull</span><span class="p">,</span>
      <span class="s2">&quot;dueDate&quot;</span><span class="o">:</span> <span class="n">isNotNull</span>
    <span class="p">})));</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>


<h3 id="testing-with-a-database">Testing with a Database</h3>
<p>Aqueduct's ORM uses PostgreSQL as its database. Before your tests run, Aqueduct will create your application's database tables in a local PostgreSQL database. After the tests complete, it will delete those tables. This allows you to start with an empty database for each test suite as well as control exactly which records are in your database while testing, but without having to manage database schemas or use an mock implementation (e.g., SQLite).</p>
<p>This behavior, and behavior for managing applications with an OAuth 2.0 provider, are available as <a href="../testing/mixins/">harness mixins</a>.</p>
<h2 id="documentation">Documentation</h2>
<p>OpenAPI documents describe your application's interface. These documents can be used to generate documentation and client code. A document can be generated by reflecting on your application's codebase, just run the <code>aqueduct document</code> command.</p>
<p>The <code>aqueduct document client</code> command creates a web page that can be used to configure issue requests specific to your application.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../getting_started/" title="Getting Started" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </span>
            </div>
          </a>
        
        
          <a href="../best_practices/" title="Best Practices" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Best Practices
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Built by Stable Kernel
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-3700c4cc12.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-41269877-2","aqueduct.io"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>